<%@ page language="java" contentType="text/html; charset=UTF-8"	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<script>
$(function(){
	$("#autoKey").keyup(function(){
		let keyword=$("#autoKey").val();
		if(keyword.length===0){
		$("#autocomplete").css("visibility","hidden");
		}else{
			$("#autocomplete").css("visibility","visible");
			$.ajax({
				url: "/syLibrary/recmd_servlet/search.do",
				data:{"keyword":keyword},
				success:function(txt){
					$("#autocomplete").html(txt);
				}
			});
		}
	});
	
	$("#chkAll").click(function() {
		if(!$("#chkAll").is(":checked")) {
			console.log('checked');
			$("#chkAll").attr("checked", true);
			$("input[name=checkIdx]").prop("checked", true);			
			console.log('$(input[name=checkIdx])');
		}else {
			console.log('else');
			$("#chkAll").attr("checked", false);
			$("input[name=checkIdx]").prop("checked", false);
		}
	});
	
	$("#btnDelete").click(function() {
		let arr=$("input[name=checkIdx]:checked");	//체크박스 배열
		let cnt=0;	// 체크된 태그 개수
		let values='';
		for(i=0; i<arr.length; i++){
			if(arr[i].checked==true) cnt++;
			values += arr[i].value+",";
			//console.log(values+"11");
		}
		
		if(cnt==0){
			alert("삭제할 항목을 선택해주세요.");
			return;
		}else{
			//console.log(values+"22");
			$.ajax({
				url: "/syLibrary/recmd_servlet/delete.do",
				data:{"cnt":cnt, "arr":values},
				success:function(txt){
					alert(txt);
					showTableList();
				}
			});
		}
	});
});

function insert(e){
 	$.ajax({
		url: "/syLibrary/recmd_servlet/insert.do",
		data:{"b_id":e, "a_id":"${a_id}"},
		success:function(txt){
			alert(txt);
			showTableList();
		}
	}); 
}
</script>


<style>
.modal-container {
width:100%;
height:100%;
padding:1%;
}

.modal-container > div{
margin-bottom:1%;
}

th > input[type="checkbox"] {
display:none;
}

td > label {
cursor: pointer;
}

b {
color:crimson;
}
.auto-head {
padding:1%;
text-align:left;
}
#modal-section2 {
min-height:40%;
}
#autocomplete {
padding: 0 0 1% 0;
height:250px;
overflow-y: auto;
}
#autocomplete .tbody {
padding-left:1%; 
padding-right:1%; 
}
</style>
</head>



<div class="modal-container">
<div id="modal-header" class="d-flex justify-content-between">
	<div><h3>&nbsp;&nbsp;<i class="bi bi-magic"></i>&nbsp;EDIT</h3></div>
	<div><button type="button" class="btn-close" id="btnClose" onclick="closeModal()"></button></div>
</div><!-- modal-header 끝 -->

<div id="modal-section1" class="d-flex-col">
<table class="table table-sm table-striped table-hover align-middle text-center">
	<thead>
		<tr>
			<th scope="col">no.</th>
			<th scope="col">등록번호</th>
			<th scope="col">제목</th>
			<th scope="col">저자</th>
			<th scope="col">발행처</th>
			<th scope="col">등록</th>
			<th scope="col">
				<input type="checkbox" id="chkAll" name="chkAll" checked="false">
				<label class="btn" for="chkAll"><i class="bi bi-check-all"></i></label>
			</th>
		</tr>
	</thead>
	<tbody class="table-group-divider">
	<c:forEach var="item" items="${list }">
		<tr>
			<th scope="row">${item.ROWNUM}</th>
			<td>${item.B_ID}</td>
			<td><strong>${item.B_NAME}</strong></td>
			<td>${item.B_AUTHOR}</td>
			<td>${item.B_PUB}(${item.B_YEAR})</td>
			<td>
			${item.A_NAME}(${item.POST_DATE})
			</td>
			<td>
  			<input type="checkbox" value="${item.IDX}" name="checkIdx">
			</td>
		</tr>
	</c:forEach>
	</tbody>
</table>
</div><!-- modal-section1 끝 -->

<div id="buttons" class="d-flex-col" style="float:right;">
	<button type="button" class="btn btn-sm btn-outline" id="btnDelete" name="btnDelete"><strong>DELETE</strong></button>
	&nbsp;&nbsp;
</div><!-- buttons -->

<div id="modal-section2" class="d-flex-col">
<div class="auto-head" >
&nbsp;추천도서는 <b>5권</b>까지 등록할 수 있습니다. 찾으시는 책의 키워드를 입력해주세요.
</div><!-- auto-head 끝 -->
<div id="auto-search" class="input-group mb-3">
		<button class="btn btn-light" type="button" id="btnSearch" disabled style="background-color: #d8bfd8;">
			<i class="bi bi-search"></i>
		</button>
		<input id="autoKey" name="autoKey" type="text" class="form-control" placeholder="검색어를 입력하세요">
</div><!-- auto-search 끝 -->
<div id="autocomplete"></div>
</div><!-- modal-section2 끝 -->

</div><!-- modal-container 끝 -->

</html>